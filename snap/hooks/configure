#!/bin/sh

# Get the parameters from the snap settings
controller=$(snapctl get controller)
project=$(snapctl get project)
registrationToken=$(snapctl get registrationToken)

# Store the credentials
cd $SNAP
bin/agent --controller $controller --project $project --registration-token $registrationToken  --conf-dir $SNAP_DATA/etc/deviceplane  --state-dir $SNAP_DATA/var/lib/deviceplane

# Restart the service
snapctl restart ${SNAP_NAME}.deviceplane-agent